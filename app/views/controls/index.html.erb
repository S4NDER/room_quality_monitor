<% provide(:title, "RQM System Control Page") %>
<h1>Control Page</h1>

<h3>Devices</h3>

<div id="devices"> 
    <div class="row">
        <div class="col s12">       
            <% Device.all.each do |device| %>        
                <div class="col s6">
                    <div class="z-depth-4">
                    <div class="card-panel teal">
                        <span class="white-text">
                            <h5><b><%=device.device_name %></b></h5></br>                            
                            <a class="edit_data btn orange modal-trigger" data-device_name="<%=device.device_name %>" data-type="Audio" data-toggle="modal" data-target="modal1"><i class="material-icons ">show_chart</i></a>
                            Audio: <%=device.audios.last.value %> dB              (<%=device.audios.last.updated_at.strftime("%H:%M:%S")%>)</br>     

                            <a class="edit_data btn orange modal-trigger" data-device_name="<%=device.device_name %>" data-type="Temperature" data-toggle="modal" data-target="modal1"><i class="material-icons ">show_chart</i></a>
                            Temperature: <%=device.temperatures.last.value %> Â°C  (<%=device.temperatures.last.updated_at.strftime("%H:%M:%S")%>)</br>
                            
                            <a class="edit_data btn orange modal-trigger" data-device_name="<%=device.device_name %>" data-type="Luminosity" data-toggle="modal" data-target="modal1"><i class="material-icons ">show_chart</i></a>
                            Luminosity:  <%=device.luminosities.last.value %> lux (<%=device.luminosities.last.updated_at.strftime("%H:%M:%S")%>)</br>
                            
                            <a class="edit_data btn orange modal-trigger" data-device_name="<%=device.device_name %>" data-type="Humidity" data-toggle="modal" data-target="modal1"><i class="material-icons ">show_chart</i></a>                            
                            Humidity:    <%=device.humidities.last.value %> %     (<%=device.humidities.last.updated_at.strftime("%H:%M:%S")%>)</br>
                        </span>
                    </div>
                </div>
                </div>
            <% end %>
         </div>
    </div>
</div>


<div id="modal1" class="modal">
    <div class="modal-content">
        <h4><strong id="data-device_name"></strong>:  <strong id="data-type"></strong></h4>
        <%= line_chart (Device.last.audios.group_by_minute(:created_at, 
        range: 1.hours.ago..Time.now).maximum(:value)),
        xtitle: "Time"
        %>
    </div>
</div>